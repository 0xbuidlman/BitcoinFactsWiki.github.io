<!DOCTYPE html>
<html>
<head>

<meta charset="utf-8" />
<title>CVE-2013-2293</title>

<link rel="stylesheet" href="../style.css" type="text/css" />

<link rel="stylesheet" href="../local.css" type="text/css" />

<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>









</head>
<body>

<article class="page">

<section class="pageheader">
<header class="header">
<span>
<span class="parentlinks">

<a href="../">bitcoin</a>/ 

</span>
<span class="title">
CVE-2013-2293

</span>
</span>



</header>


<nav class="actions">
<ul>







<li><span class="createlink"><a href="/ikiwiki.cgi?from=CVE-2013-2293&amp;page=Talk&amp;do=create" rel="nofollow">?</a>Talk</span></li>


</ul>
</nav>








</section>

<div id="pagebody">

<section id="content" role="main">
<h2 id="New_DoS_vulnerability_by_Forcing_Continuous_Hard_Disk_Seek.2FRead_Activity">New DoS vulnerability by Forcing Continuous Hard Disk Seek/Read Activity</h2>

<p>Private Release Date: 08-JAN-2013<br />
Public Release Date: 14-FEB-2013<br /></p>

<h2 id="Systems_Affected">Systems Affected</h2>

<ul>
<li>Satoshi Bitcoin Client (Bitcoin-Qt, bitcoind)</li>
<li>All Bitcoin clients that mimic the behavior related to transaction validation of Satoshi client versions prior 0.8.0</li>
</ul>


<h2 id="Affected_Versions">Affected Versions</h2>

<ul>
<li>Bitcoin version 0.7.2 released 2012-12-14</li>
<li>Bitcoin version 0.7.1 released 2012-10-19</li>
<li>Bitcoin version 0.7.0 released 2012-09-17</li>
<li>Bitcoin version 0.6.3 released 2012-06-25</li>
<li>Bitcoin version 0.6.2 released 2012-05-08</li>
<li>Bitcoin version 0.6.1 released 2012-05-04</li>
<li>Bitcoin version 0.6.0 released 2012-03-30</li>
<li>Bitcoin version 0.5.3.1 released 2012-03-16</li>
<li>Bitcoin version 0.5.3 released 2012-03-14</li>
<li>Bitcoin version 0.5.2 released 2012-01-09</li>
<li>Bitcoin version 0.5.1 released 2011-12-15</li>
<li>Bitcoin version 0.5.0 released 2011-11-21</li>
<li>Bitcoin version 0.4.0 released 2011-09-23</li>
<li>Bitcoin version 0.3.24 released 2011-07-08</li>
<li>Bitcoin version 0.3.23 released 2011-06-14</li>
<li>Bitcoin version 0.3.22 released 2011-06-05</li>
<li>Bitcoin version 0.3.21 released 2011-04-27</li>
</ul>


<h2 id="Overview">Overview</h2>

<p>Transaction processing has two stages in Satoshi Bitcoin client. In the first stage, transaction inputs are fetched.
This is done by bringing to RAM the transactions that contains the outputs referred by the inputs.
In the second stage, previous outputs are verified to be unspent and the related scripts are evaluated.
Since double spends are not considered to be a DoS attempt by the protocol rules, a transaction that refers to previous spent outputs will pass the first processing stage without being discarded. An attacker can therefore construct transactions that, before being discarded in the second stage of processing, require the victim application to seek and read too many parts of the block chain that could be scattered thought the storage files, delaying any other processing.</p>

<h2 id="Details">Details</h2>

<p>We assume that the whole block chain does not fit in RAM, so each transaction fetch requires a HD seek and read. An average 7200 rpm hard drive
can random seek/read a 1Kb block in a non-cached 2 Gb file in 12 msec. Each prevout of a transaction consumes 44 bytes, with empty sigscripts.
The attacker creates transaction with many inputs an one output. In this way, the other sections of the transaction (output scripts, headers) are amortized and become irrelevant to this analysis.
For an Internet connection of 50 Kbytes/sec bandwidth, sending 45 bytes requires less than 1 msec.
By continuously sending this specially crafted transactions an attacker can block any Bitcoin peer from performing other tasks.
Also the attacker may be able to block 10 peers at the same time, since the relation of 1:10 in required resources.
Note that the attacker does not need to sign the inputs nor to have the full block-chain to perform the attack. He only requires the hashes of all previous transactions, which currently requires only 10876856*32=332 Mbytes of storage.</p>

<p>Version 0.8.0 of the Satoshi client stores only unspent prevouts in memory and can abort processing right after a spent prevout is referred by a transaction.</p>

<h2 id="Possible_Attack_Scenarios">Possible Attack Scenarios</h2>

<ol>
<li><p>Because of the small resources required to mount the attack, it could be performed by botnets to massively attack the Bitcoin network.</p></li>
<li><p>The attack can be used against miners to prevent them from sending blocks. Nevertheless, currently big miners are only connected  to there own front-line of Bitcoin nodes to preven such attacks.</p></li>
<li><p>By using many nodes at once, an attacker may try to create a barrier that splits the network in unconnected components, in order to carry another kind of attack.</p></li>
</ol>


<h2 id="Not-a-problem_variations">Not-a-problem variations</h2>

<ol>
<li>A valid 1M transaction could be constructed to reference more than 22K unique input transactions. In theory that transaction would take more than 5 minutes to be verified. Nevertheless the attack is unpractical for two reasons:<br /></li>
<li>The attacker should have to own those 22K transactions.<br /></li>
<li>Those 22K transactions should have to be  scattered thought the blockchain to force HD seeking activity. If they were created in a limited period of time, they would end up confined in a limited portion of the block chain file. The result would be that the hard disk cache will help to reduce the read latency and so attack effectiveness will be reduced. Nevertheless version 0.8.0 of the Satoshi client considers transactions greater that 100K to be non-standard, so the vulnerability is further reduced.</li>
</ol>


<h2 id="Suggested_Solution_for_0.6.2F0.7_versions">Suggested Solution for 0.6/0.7 versions</h2>

<p>The client application could verify that prevouts are not spent each time they are fetched, and abort if a spent prevout is found.</p>

<pre><code>bool CTransaction::FetchInputs(CTxDB&amp; txdb, const map&lt;uint256, CTxIndex&gt;&amp; mapTestPool,
bool fBlock, bool fMiner, MapPrevTx&amp; inputsRet, bool&amp; fInvalid)
{
..
for (unsigned int i = 0; i &lt; vin.size(); i++)
{
// Read txPrev
CTransaction&amp; txPrev = inputsRet&lt;span class=&quot;createlink&quot;&gt;&lt;a href=&quot;/ikiwiki.cgi?from=CVE-2013-2293&amp;amp;do=create&amp;amp;page=prevout.hash&quot; rel=&quot;nofollow&quot;&gt;?&lt;/a&gt;prevout.hash&lt;/span&gt;.second;
....
// NEW CODE BEGINS
if (prevout.n &gt;= txPrev.vout.size()  prevout.n &gt;= txindex.vSpent.size())
{
fInvalid = true;
return DoS(100, error(&quot; .....
}
if (!txindex.vSpent&lt;span class=&quot;createlink&quot;&gt;&lt;a href=&quot;/ikiwiki.cgi?do=create&amp;amp;page=prevout.n&amp;amp;from=CVE-2013-2293&quot; rel=&quot;nofollow&quot;&gt;?&lt;/a&gt;prevout.n&lt;/span&gt;.IsNull())
return false;
// NEW CODE ENDS
}
}
</code></pre>

<h2 id="Disclosure_Timeline">Disclosure Timeline</h2>

<p>2013-01-09 - Vulnerability reported to Gavin Andressen and other core devs.<br />
2013-01-09 - Gavin Andressen acknowledges report and confirms version 0.8 will not be vulnerable, permits disclosure after 0.8.0 release candidate 1 is available.<br />
2013-02-09 - Bitcoin version 0.8.0 release candidate 1 is available, fixing the vulnerability<br />
2013-02-14 - Vulnerability disclosure<br /></p>

<h2 id="Credit">Credit</h2>

<p>This vulnerability was discovered by Sergio Demian Lerner, from Certimix.com.
This report was written by SDL.</p>

<h2 id="See_Also">See Also</h2>

<ul>
<li><a href="../Common_Vulnerabilities_and_Exposures/">Common Vulnerabilities and Exposures</a></li>
</ul>


</section>







</div>

<footer id="footer" class="pagefooter" role="contentinfo">

<nav id="pageinfo">






<nav id="backlinks">
Links:

<a href="../Common_Vulnerabilities_and_Exposures/">Common Vulnerabilities and Exposures</a>


</nav>


<div class="copyrightinfo">
Content is available under under <a href="https://creativecommons.org/licenses/by-sa/3.0/">CC by-sa</a>
</div>

<div class="pagedate">
Last edited <time datetime="2015-03-06T15:54:20Z">Fri 06 Mar 2015 03:54:20 PM Europe</time>
<!-- Created <time datetime="2013-03-05T18:58:44Z" pubdate="pubdate">Tue 05 Mar 2013 06:58:44 PM Europe</time> -->
</div>

</nav>


<!-- from bitcoin -->
</footer>
</article>

</body>
</html>
